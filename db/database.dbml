// =========================
// ENUMS
// =========================
Enum category_type {
  normal
  makanan
}

Enum order_status {
  pending
  paid
  shipped
  completed
  cancelled
}

Enum invoice_status {
  unpaid
  paid
  expired
}

Enum payment_type {
  Mandiri
  BNI
  BCA
}

// =========================
// CORE CATALOG
// =========================
Table categories {
  id bigint [pk, increment]
  name varchar
  slug varchar [unique]
  description text
  type category_type [default: 'normal']
  created_at datetime
  updated_at datetime
}

Table products {
  id bigint [pk, increment]
  category_id bigint [not null]
  name varchar
  slug varchar [unique]
  description text
  base_price decimal(12,2)
  is_active boolean [default: true]
  created_at datetime
  updated_at datetime

  Indexes {
    category_id
  }
}

Table product_images {
  id bigint [pk, increment]
  product_id bigint [not null]
  image_url varchar
  is_primary boolean [default: false]

  Indexes {
    product_id
  }
}

Table product_motifs {
  id bigint [pk, increment]
  product_id bigint [not null]
  name varchar
  additional_price decimal(12,2) [default: 0]

  Indexes {
    product_id
  }
}

Table product_motif_images {
  id bigint [pk, increment]
  product_motif_id bigint [not null]
  image_url varchar
  is_primary boolean [default: false]

  Indexes {
    product_motif_id
  }
}

Table product_sizes {
  id bigint [pk, increment]
  product_id bigint [not null]
  name varchar 
  additional_price decimal(12,2) [default: 0]
  stock int [default: 0]

  Indexes {
    product_id
  }
}

// =========================
// USERS & ADDRESS
// =========================
Table users {
  id bigint [pk, increment]
  name varchar
  email varchar [unique]
  password varchar
  phone varchar
  created_at datetime
  updated_at datetime
}

Table addresses {
  id bigint [pk, increment]
  user_id bigint [not null]
  recipient_name varchar
  phone varchar
  address_detail text
  city varchar
  province varchar
  postal_code varchar
  is_primary boolean [default: true]
  created_at datetime
  updated_at datetime

  Indexes {
    user_id
    (user_id, is_primary)
  }

  Note: 'Pastikan hanya 1 address primary per user. Implement via partial unique index (user_id) WHERE is_primary=true (di PostgreSQL) atau logic di app/trigger.'
}

// =========================
// CART
// =========================
Table carts {
  id bigint [pk, increment]
  user_id bigint [not null, unique] // 1 user 1 cart aktif
  created_at datetime
  updated_at datetime
}

Table cart_items {
  id bigint [pk, increment]
  cart_id bigint [not null]
  product_id bigint [not null]
  motif_id bigint
  size_id bigint
  quantity int [not null, default: 1]
  unit_price decimal(12,2) [not null]
  subtotal decimal(12,2) [not null]

  Indexes {
    cart_id
    product_id
    motif_id
    size_id
  }
}

// =========================
// PAYMENT METHOD
// =========================
Table payment_methods {
  id bigint [pk, increment]
  name varchar
  type payment_type
  account_number varchar
  account_name varchar
  is_active boolean [default: true]
  created_at datetime
  updated_at datetime
}

// =========================
// ORDER & INVOICE
// =========================
Table orders {
  id bigint [pk, increment]
  user_id bigint [not null]
  payment_method_id bigint

  order_number varchar [unique]

  // shipping snapshot (bisa alamat lain)
  shipping_name varchar
  shipping_phone varchar
  shipping_address text
  shipping_city varchar
  shipping_province varchar
  shipping_postal_code varchar

  total_amount decimal(12,2) [not null, default: 0]
  shipping_cost decimal(12,2) [not null, default: 0]
  status order_status [default: 'pending']

  created_at datetime
  updated_at datetime

  Indexes {
    user_id
    payment_method_id
  }
}

Table order_items {
  id bigint [pk, increment]
  order_id bigint [not null]
  product_id bigint [not null]
  motif_id bigint
  size_id bigint

  // qty vs gram:
  quantity int [default: 1] // untuk non makanan
  weight_in_gram int // untuk makanan (nullable)

  unit_price decimal(12,2) [not null]
  subtotal decimal(12,2) [not null]

  Indexes {
    order_id
    product_id
    motif_id
    size_id
  }

  Note: 'Jika category.type=makanan, gunakan weight_in_gram untuk hitung subtotal (mis: price_per_gram * weight_in_gram).'
}

Table invoices {
  id bigint [pk, increment]
  order_id bigint [not null, unique] // 1 order 1 invoice
  invoice_number varchar [unique]
  invoice_date datetime
  due_date datetime
  total_amount decimal(12,2) [not null]
  status invoice_status [default: 'unpaid']
  created_at datetime
  updated_at datetime
}

// =========================
// CMS: GALLERY, BLOG, ABOUT
// =========================
Table galleries {
  id bigint [pk, increment]
  title varchar
  image_url varchar
  description text
  created_at datetime
  updated_at datetime
}

Table blogs {
  id bigint [pk, increment]
  title varchar
  slug varchar [unique]
  thumbnail varchar
  content text
  author varchar
  is_published boolean [default: false]
  created_at datetime
  updated_at datetime
}

Table about {
  id bigint [pk, increment]
  title varchar
  content text
  vision text
  mission text
  updated_at datetime

  Note: 'Biasanya hanya 1 row.'
}

// =========================
// RELATIONSHIPS (Refs)
// =========================
Ref: products.category_id > categories.id

Ref: product_images.product_id > products.id

Ref: product_motifs.product_id > products.id
Ref: product_motif_images.product_motif_id > product_motifs.id

Ref: product_sizes.product_id > products.id

Ref: addresses.user_id > users.id

Ref: carts.user_id > users.id
Ref: cart_items.cart_id > carts.id
Ref: cart_items.product_id > products.id
Ref: cart_items.motif_id > product_motifs.id
Ref: cart_items.size_id > product_sizes.id

Ref: orders.user_id > users.id
Ref: orders.payment_method_id > payment_methods.id

Ref: order_items.order_id > orders.id
Ref: order_items.product_id > products.id
Ref: order_items.motif_id > product_motifs.id
Ref: order_items.size_id > product_sizes.id

Ref: invoices.order_id > orders.id
 